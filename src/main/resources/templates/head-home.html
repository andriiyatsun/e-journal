<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Панель голови відділу</title>
    <style>
        :root {
            --bg:#f5f5f5; --card:#fff; --text:#333; --muted:#555;
            --primary:#007bff; --primary-hover:#0056b3; --border:#ddd;
            --shadow:0 2px 10px rgba(0,0,0,.1); --radius:8px
        }
        * { box-sizing: border-box }
        html, body { height:100%; margin:0; font-family: Arial, sans-serif; background:var(--bg); color:var(--text) }

        /* ===== Header ===== */
        .site-header{ background:var(--card); box-shadow:var(--shadow); position:sticky; top:0; z-index:50 }
        .site-header .container{ max-width:1200px; margin:0 auto; padding:.6rem 1rem; display:flex; align-items:center; gap:.75rem }
        .header-left{ display:flex; align-items:center; gap:.75rem }
        .exit-btn{ padding:.45rem .7rem; border:1px solid var(--border); background:#fff; color:var(--text); border-radius:6px; text-decoration:none }
        .exit-btn:hover{ border-color:#e06666; background:#fff4f4 }
        .brand{ display:flex; align-items:center; gap:.6rem }
        .brand__logo{ width:32px; height:32px; border-radius:6px; background:var(--primary); display:inline-block }
        .brand__title{ font-size:1.05rem; font-weight:bold }
        .header-tabs{ margin-left:auto; display:flex; gap:.5rem; flex-wrap:wrap }
        .tab-btn{ padding:.5rem .75rem; background:#fff; border:1px solid var(--border); border-radius:6px; cursor:pointer; color:var(--text) }
        .tab-btn:hover{ border-color:var(--primary) }
        .tab-btn.active{ background:var(--primary); color:#fff; border-color:var(--primary) }

        /* ===== Page ===== */
        .page{ max-width:1200px; margin:1rem auto; padding:0 1rem 2rem }
        .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:1rem }

        /* Panels */
        .tab-panel{ display:none }
        .tab-panel.active{ display:block }
        .section-title{ margin:.2rem 0 .75rem; font-size:1.2rem; color:var(--primary) }
        .helper{ color:var(--muted); font-size:.92rem }

        /* Table */
        .table{ width:100%; border-collapse:collapse; border:1px solid var(--border); border-radius:6px; overflow:hidden }
        .table th,.table td{ padding:.6rem .75rem; border-bottom:1px solid var(--border); text-align:left; vertical-align:middle }
        .table th{ background:#fafafa; color:var(--muted); font-weight:bold }
        .table tr:last-child td{ border-bottom:none }
        .table tr:hover{ background:#f8faff }

        /* Buttons */
        .btn{ padding:.4rem .65rem; border-radius:6px; border:1px solid var(--border); background:#fff; cursor:pointer }
        .btn--primary{ background:var(--primary); border-color:var(--primary); color:#fff }
        .btn--success{ background:#28a745; border-color:#28a745; color:#fff }
        .btn--warning{ background:#ffc107; border-color:#ffc107; color:#000 }
        .btn:hover{ filter:brightness(.95) }

        /* Stats cards */
        .stats-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:1rem; margin-bottom:2rem }
        .stat-card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1rem; text-align:center }
        .stat-number{ font-size:1.5rem; font-weight:bold; color:var(--primary) }
        .stat-label{ color:var(--muted); font-size:.9rem }

        /* Subject cards */
        .subject-cards{ display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:1rem; margin-bottom:2rem }
        .subject-card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1rem }
        .subject-card h4{ margin:0 0 .5rem; color:var(--primary) }
        .subject-stats{ display:flex; justify-content:space-between; margin:.5rem 0; font-size:.9rem; color:var(--muted) }

        @media (max-width:760px){ .brand__title{ display:none } }
    </style>
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="header-left">
            <a class="exit-btn" href="/logout" th:href="@{/logout}">Вийти</a>
            <span class="brand">
                <span class="brand__logo"></span>
                <span class="brand__title" th:text="'Журнали &quot;' + ${head.department.name} + '&quot;'">Журнали "Назва департаменту"</span>
            </span>
        </div>
        <nav class="header-tabs" id="headTabs">
            <button class="tab-btn active" data-tab="overview">Огляд</button>
            <button class="tab-btn" data-tab="subjects">Предмети</button>
            <button class="tab-btn" data-tab="teachers">Викладачі</button>
            <!--<button class="tab-btn" data-tab="reports">Звіти</button>-->
        </nav>
    </div>
</header>

<main class="page">
    <div class="card">

        <!-- ============ OVERVIEW ============ -->
        <!-- <section id="panel-overview" class="tab-panel active">
             <h3 class="section-title" th:text="'Огляд відділу: ' + ${head.department.name}">Огляд відділу</h3>

             <!-- Статистика відділу -->
        <!--        <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" th:text="${totalTeachers ?: 0}">0</div>
                        <div class="stat-label">Викладачів</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" th:text="${totalSubjects ?: 0}">0</div>
                        <div class="stat-label">Предметів</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" th:text="${totalStudents ?: 0}">0</div>
                        <div class="stat-label">Всього учнів</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" th:text="${averageDeptGrade ?: '—'}">—</div>
                        <div class="stat-label">Середній бал відділу</div>
                    </div>
                </div>

                <!-- Найбільш активні предмети -->
        <!--  <h4>Статистика предметів</h4>
          <div class="subject-cards">
              <div class="subject-card" th:each="subject : ${departmentSubjects}">
                  <h4 th:text="${subject.name}">Назва предмета</h4>
                  <div class="subject-stats">
                      <span th:text="'Викладач: ' + (${subject.teacher?.name + ' ' + subject.teacher?.surname} ?: 'Не призначено')">Викладач: —</span>
                  </div>
                  <div class="subject-stats">
                      <span th:text="'Учнів: ' + (${subject.studentsCount ?: 0})">Учнів: 0</span>
                      <span th:text="'Середній бал: ' + (${subject.averageGrade ?: '—'})">Середній бал: —</span>
                  </div>
                  <button class="btn btn--primary" th:onclick="'viewSubjectDetails(' + ${subject.id} + ')'">Детальніше</button>
              </div>
          </div>
      </section>

      <!-- ============ SUBJECTS ============ -->
        <!--  <section id="panel-subjects" class="tab-panel">
              <h3 class="section-title">Предмети відділу</h3>

              <table class="table">
                  <thead>
                  <tr>
                      <th>Назва предмета</th>
                      <th>Викладач</th>
                      <th>К-ть учнів</th>
                      <th>Середній бал</th>
                      <th>Статус</th>
                      <th>Дії</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="subject : ${departmentSubjects}">
                      <td th:text="${subject.name}">Назва предмета</td>
                      <td th:text="${subject.teacher != null ? subject.teacher.name + ' ' + subject.teacher.surname : 'Не призначено'}">Викладач</td>
                      <td th:text="${subject.studentsCount ?: 0}">0</td>
                      <td th:text="${subject.averageGrade ?: '—'}">—</td>
                      <td>
                          <span th:if="${subject.teacher != null}" class="btn btn--success" style="font-size:.8rem">Активний</span>
                          <span th:unless="${subject.teacher != null}" class="btn btn--warning" style="font-size:.8rem">Потрібен викладач</span>
                      </td>
                      <td>
                          <button class="btn btn--primary" th:onclick="'viewSubject(' + ${subject.id} + ')'">Переглянути</button>
                      </td>
                  </tr>
                  <tr th:if="${#lists.isEmpty(departmentSubjects)}">
                      <td colspan="6" class="helper">Предметів поки що немає.</td>
                  </tr>
                  </tbody>
              </table>
          </section>

           ============ TEACHERS ============ -->
        <section id="panel-teachers" class="tab-panel">
            <h3 class="section-title">Викладачі відділу</h3>

            <table class="table">
                <thead>
                <tr>
                    <th>Ім'я</th>
                    <th>Прізвище</th>
                    <th>Email</th>
                    <th>Предмет</th>
                    <th>К-ть учнів</th>
                    <th>Дії</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="teacher : ${departmentTeachers}">
                    <td th:text="${teacher.name}">Ім'я</td>
                    <td th:text="${teacher.surname}">Прізвище</td>
                    <td th:text="${teacher.email}">email</td>
                    <td th:text="${teacher.subject != null ? teacher.subject.name : '—'}">Предмет</td>
                    <td th:text="${teacher.studentsCount ?: 0}">0</td>
                    <td>
                        <button class="btn btn--primary" th:onclick="'viewTeacher(' + ${teacher.id} + ')'">Переглянути</button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(departmentTeachers)}">
                    <td colspan="6" class="helper">Викладачів поки що немає.</td>
                </tr>
                </tbody>
            </table>
        </section>

        <!-- ============ REPORTS ============ -->
        <section id="panel-reports" class="tab-panel">
            <h3 class="section-title">Звіти та аналітика</h3>

            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:1rem; margin-bottom:2rem">
                <button class="btn btn--primary" onclick="generateDeptReport()">Звіт по відділу</button>
                <button class="btn btn--primary" onclick="generateGradesReport()">Звіт по оцінках</button>
                <button class="btn btn--primary" onclick="generateAttendanceReport()">Звіт по відвідуваності</button>
                <button class="btn btn--primary" onclick="generateTeachersReport()">Звіт по викладачах</button>
            </div>

            <div id="reportContent" style="margin-top:1rem; padding:1rem; border:1px solid var(--border); border-radius:var(--radius); display:none">
                <h4>Результати звіту</h4>
                <div id="reportData"></div>
            </div>

            <!-- Швидкі дії -->
            <h4>Швидкі дії</h4>
            <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:1rem">
                <button class="btn btn--success" onclick="exportAllGrades()">Експорт всіх оцінок</button>
                <button class="btn btn--warning" onclick="sendReminders()">Відправити нагадування викладачам</button>
                <button class="btn btn--primary" onclick="scheduleReport()">Запланувати автозвіт</button>
            </div>
        </section>

    </div>
</main>

<script>
    // Tabs switcher
    (function(){
        const tabs = document.querySelectorAll('#headTabs .tab-btn');
        const panels = {
            overview: document.getElementById('panel-overview'),
            subjects: document.getElementById('panel-subjects'),
            teachers: document.getElementById('panel-teachers'),
            reports: document.getElementById('panel-reports')
        };
        function activate(name){
            tabs.forEach(b=>b.classList.toggle('active', b.dataset.tab===name));
            Object.keys(panels).forEach(k=>panels[k].classList.toggle('active', k===name));
            history.replaceState(null,'',`#${name}`);
        }
        tabs.forEach(btn=>btn.addEventListener('click',()=>activate(btn.dataset.tab)));
        const fromHash = location.hash?.replace('#','');
        if(fromHash && panels[fromHash]) activate(fromHash);
    })();

    // Subject and teacher detail functions
    function viewSubjectDetails(subjectId) {
        window.location.href = `/head/subjects/${subjectId}/details`;
    }

    function viewSubject(subjectId) {
        window.location.href = `/head/subjects/${subjectId}`;
    }

    function viewTeacher(teacherId) {
        window.location.href = `/head/teachers/${teacherId}`;
    }

    // Report functions
    function generateDeptReport() {
        showReport('Звіт по відділу генерується...', '/head/reports/department');
    }

    function generateGradesReport() {
        showReport('Звіт по оцінках генерується...', '/head/reports/grades');
    }

    function generateAttendanceReport() {
        showReport('Звіт по відвідуваності генерується...', '/head/reports/attendance');
    }

    function generateTeachersReport() {
        showReport('Звіт по викладачах генерується...', '/head/reports/teachers');
    }

    function showReport(message, url) {
        const content = document.getElementById('reportContent');
        const data = document.getElementById('reportData');
        data.innerHTML = message;
        content.style.display = 'block';

        // Simulate API call
        setTimeout(() => {
            data.innerHTML = '<p>Звіт готовий! <a href="' + url + '" target="_blank">Завантажити PDF</a></p>';
        }, 2000);
    }

    // Quick actions
    function exportAllGrades() {
        window.location.href = '/head/export/all-grades';
    }

    function sendReminders() {
        alert('Нагадування відправлено всім викладачам відділу');
    }

    function scheduleReport() {
        alert('Функція планування автозвітів буде доступна найближчим часом');
    }
</script>

</body>
</html>