<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Журнал викладача</title>
    <style>
        :root {
            --bg:#f5f5f5; --card:#fff; --text:#333; --muted:#555;
            --primary:#007bff; --primary-hover:#0056b3; --border:#ddd;
            --shadow:0 2px 10px rgba(0,0,0,.1); --radius:8px
        }
        * { box-sizing: border-box }
        html, body { height:100%; margin:0; font-family: Arial, sans-serif; background:var(--bg); color:var(--text) }

        /* ===== Header ===== */
        .site-header{ background:var(--card); box-shadow:var(--shadow); position:sticky; top:0; z-index:50 }
        .site-header .container{ max-width:1200px; margin:0 auto; padding:.6rem 1rem; display:flex; align-items:center; gap:.75rem }
        .header-left{ display:flex; align-items:center; gap:.75rem }
        .exit-btn{ padding:.45rem .7rem; border:1px solid var(--border); background:#fff; color:var(--text); border-radius:6px; text-decoration:none }
        .exit-btn:hover{ border-color:#e06666; background:#fff4f4 }
        .brand{ display:flex; align-items:center; gap:.6rem }
        .brand__logo{ width:32px; height:32px; border-radius:6px; background:var(--primary); display:inline-block }
        .brand__title{ font-size:1.05rem; font-weight:bold }

        /* ===== Page ===== */
        .page{ max-width:1200px; margin:1rem auto; padding:0 1rem 2rem }
        .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:1rem }

        /* Section Title */
        .section-title{ margin:.2rem 0 .75rem; font-size:1.2rem; color:var(--primary) }
        .helper{ color:var(--muted); font-size:.92rem }

        /* Table */
        .table{ width:100%; border-collapse:collapse; border:1px solid var(--border); border-radius:6px; overflow:hidden }
        .table th,.table td{ padding:.6rem .75rem; border-bottom:1px solid var(--border); text-align:left; vertical-align:middle }
        .table th{ background:#fafafa; color:var(--muted); font-weight:bold }
        .table tr:last-child td{ border-bottom:none }
        .table tr:hover{ background:#f8faff }

        /* Grade input */
        .grade-input{ width:60px; padding:.3rem; border:1px solid var(--border); border-radius:4px; text-align:center }
        .grade-input:focus{ outline:none; border-color:var(--primary) }

        /* Buttons */
        .btn{ padding:.4rem .65rem; border-radius:6px; border:1px solid var(--border); background:#fff; cursor:pointer }
        .btn--primary{ background:var(--primary); border-color:var(--primary); color:#fff }
        .btn--success{ background:#28a745; border-color:#28a745; color:#fff }
        .btn:hover{ filter:brightness(.95) }

        /* Stats cards */
        .stats-grid{ display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:1rem; margin-bottom:2rem }
        .stat-card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1rem; text-align:center }
        .stat-number{ font-size:1.5rem; font-weight:bold; color:var(--primary) }
        .stat-label{ color:var(--muted); font-size:.9rem }

        @media (max-width:760px){ .brand__title{ display:none } }
    </style>
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="header-left">
            <a class="exit-btn" href="/logout" th:href="@{/logout}">Вийти</a>
            <span class="brand">
                <span class="brand__logo"></span>
                <span class="brand__title" th:text="'Журнали &quot;' + ${teacher.subject.name} + '&quot;'">Журнали "Назва предмету"</span>
            </span>
        </div>
    </div>
</header>

<main class="page">
    <div class="card">
        <h3 class="section-title" th:text="'Журнал з предмету: ' + ${teacher.subject.name}">Журнал з предмету</h3>

        <!-- Статистика -->
        <!--<div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${#lists.size(students)}">0</div>
                <div class="stat-label">Всього учнів</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${averageGrade ?: '—'}">—</div>
                <div class="stat-label">Середній бал</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${attendanceRate ?: '—'}">—</div>
                <div class="stat-label">% відвідуваності</div>
            </div>
        </div>

        <!-- Таблиця з оцінками -->
        <!--<div style="overflow-x: auto;">
            <table class="table">
                <thead>
                <tr>
                    <th>№</th>
                    <th>Учень</th>
                    <th>Група</th>
                    <th>Оцінка за семестр</th>
                    <th>Відвідуваність</th>
                    <th>Дії</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="student, iterStat : ${students}">
                    <td th:text="${iterStat.count}">1</td>
                    <td>
                        <div th:text="${student.name + ' ' + student.surname}">Ім'я Прізвище</div>
                        <small class="helper" th:text="${student.email}">email@example.com</small>
                    </td>
                    <td th:text="${student.group ?: '—'}">Група</td>
                    <td>
                        <form th:action="@{'/teacher/grades/update'}" method="post" style="display:inline">
                            <input type="hidden" name="studentId" th:value="${student.id}" />
                            <input type="hidden" name="subjectId" th:value="${teacher.subject.id}" />
                            <input type="number"
                                   class="grade-input"
                                   name="grade"
                                   min="1"
                                   max="12"
                                   th:value="${student.grade ?: ''}"
                                   placeholder="—" />
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        </form>
                    </td>
                    <td th:text="${student.attendancePercent ?: '—'} + '%'">—</td>
                    <td>
                        <button class="btn btn--primary" onclick="saveGrade(this)">Зберегти</button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(students)}">
                    <td colspan="6" class="helper">Учнів поки що немає.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Додаткові дії -->
        <!--<div style="margin-top:1.5rem; display:flex; gap:1rem; flex-wrap:wrap">
            <button class="btn btn--success" onclick="exportGrades()">Експорт оцінок</button>
            <button class="btn btn--primary" onclick="showAttendanceForm()">Відмітити відвідуваність</button>
        </div>

        <!-- Форма відвідуваності (приховано за замовчуванням) -->
        <!--<div id="attendanceForm" style="display:none; margin-top:1rem; padding:1rem; border:1px solid var(--border); border-radius:var(--radius)">
            <h4>Відмітити відвідуваність на сьогодні</h4>
            <form th:action="@{/teacher/attendance/mark}" method="post">
                <div th:each="student : ${students}" style="margin:.5rem 0">
                    <label style="display:flex; align-items:center; gap:.5rem">
                        <input type="checkbox" th:name="'present_' + ${student.id}" checked />
                        <span th:text="${student.name + ' ' + student.surname}">Ім'я Прізвище</span>
                    </label>
                </div>
                <input type="hidden" name="date" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" />
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="btn btn--success" style="margin-top:1rem">Зберегти відвідуваність</button>
            </form>
        </div>
    </div>
</main>-->


<script>
    function saveGrade(button) {
        const form = button.closest('tr').querySelector('form');
        const gradeInput = form.querySelector('input[name="grade"]');

        if (!gradeInput.value || gradeInput.value < 1 || gradeInput.value > 12) {
            alert('Введіть коректну оцінку (1-12)');
            return;
        }

        form.submit();
    }

    function exportGrades() {
        window.location.href = '/teacher/grades/export';
    }

    function showAttendanceForm() {
        const form = document.getElementById('attendanceForm');
        form.style.display = form.style.display === 'none' || !form.style.display ? 'block' : 'none';
    }

    // Auto-save grades on Enter
    document.querySelectorAll('.grade-input').forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const button = this.closest('tr').querySelector('button');
                saveGrade(button);
            }
        });
    });
</script>

</body>
</html>